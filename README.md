# Handling Indeterminate Predictions of Vascular Access Dysfunction in Chronic Hemodialysis Patients through Tree-Based Approaches

## 1. 研究背景與動機
### 背景
慢性腎臟病患者需要透析治療，而血管通路功能障礙是常見且嚴重的併發症。在台灣，由於透析患者比例為全球最高，血管通路功能的監測與早期診斷至關重要。然而，傳統方法如 **KDOQI 指南**（基於固定血流量閾值）和身體檢查，往往無法準確識別需要手術介入的患者。

### 動機
現有方法難以應對病患個體差異，且缺乏處理不確定性的機制，導致誤判或延遲診斷。機器學習模型能夠在此方面提供更好的支持，但目前的研究大多聚焦於提高預測準確度，而忽略了解釋性與不確定性管理。因此，本研究的目標是 **開發一個能處理不確定性並提升預測準確性的機器學習框架**。

## 2. 研究目標
本研究提出一個 **具備不確定感知能力的樹狀機器學習框架**，用於慢性血液透析患者的血管通路功能障礙預測，目標如下：
- **量化預測的不確定性**，避免過度自信的錯誤分類。
- **運用樹狀機器學習模型**（Decision Trees、Random Forests、XGBoost），確保預測結果的可解釋性。
- **融合臨床指南與數據驅動方法**，提供更精準的診斷決策。

## 3. 相關研究
### 3.1 KDOQI 指南
- KDOQI（Kidney Disease Outcomes Quality Initiative）指南提供了血管通路管理的標準，建議 **AVF（動靜脈瘻）血流量低於 500mL/min**，或 **AVG（動靜脈移植物）低於 600mL/min** 時，應進一步評估是否存在狹窄或功能不全。

### 3.2 傳統臨床檢測
- 透過血流量（Qa）監測與體檢來檢測狹窄情況。但對於 AVG 病患，因其血管結構特殊，仍需額外輔助診斷工具（如超音波）。

### 3.3 樹狀機器學習模型
- **決策樹（Decision Trees）**：結構簡單，解釋性強，但易過擬合。
- **隨機森林（Random Forests）**：透過多棵決策樹降低方差，提高穩定性。
- **XGBoost**：梯度提升技術，透過加權學習減少誤差，適合大規模數據。

### 3.4 集成學習（Ensemble Learning）
- 結合多種模型，透過 **Soft Voting** 方法（加權投票）提升預測能力。

### 3.5 不確定性處理與可解釋性
- 透過多次擾動（Multipass Perturbation）模擬數據變異，分析預測的不確定性。
- 使用擴展混淆矩陣，增加「不確定」分類，提高臨床決策的可靠性。

## 4. 方法
### 4.1 模型架構
- 使用 **決策樹、隨機森林、XGBoost** 組成 **Soft Voting** 模型。
- 為了解決數據不平衡問題，在 XGBoost 設置 `scale_pos_weight` 參數。
- 採用 K 折交叉驗證（K-Fold Cross-Validation）以確保模型穩定性。

### 4.2 多重擾動不確定性估計（Multipass Indeterminacy Estimation）
1. **對樣本加入高斯雜訊（Gaussian Noise）**，模擬血流量的變動。
2. **多次通過分類器計算機率平均值（Mean）與變異數（Variance）**，量化預測結果的不確定性。
3. **若變異性過大則標記為「不確定」**，避免錯誤分類。

### 4.3 不確定性感知分類
- 若樣本的資訊熵（Entropy）高於閾值 **θµ**，則標記為「不確定」。
- 若差異明顯，則根據置信區間分類為「手術需要」或「不需要手術」。

## 5. 實驗與結果
### 5.1 數據集
- **來自某醫院，共 5,860 筆記錄，412 位患者**
- 分為 **AVF（85.1%）與 AVG（14.9%）兩個子集**
- 主要輸入特徵：
  - **靜態特徵**（年齡、性別、共病症如糖尿病、高血壓等）
  - **動態特徵**（血管通路類型、Qa 值變化）

### 5.2 評估指標
- 擴展混淆矩陣（Extended Confusion Matrix）：
  - **新增「不確定陽性（IP）」與「不確定陰性（IN）」類別**
- **評估指標**：
  - **準確率（Accuracy）**
  - **陽性預測值（PPV）**
  - **陰性預測值（NPV）**
  - **誤判率（Error）**
  - **不確定率（Indeterminate）**
  - **洩漏率（Leakage）**（應手術卻未標記）
  - **過度治療率（Overkill）**（未必要手術卻標記）

### 5.3 結果分析
- **AVF 結果**：
  - KDOQI 準確率：**87.2%**，本研究方法提升至 **91.3%**
  - **AUC（曲線下面積）從 0.62 提升至 0.76**
- **AVG 結果**：
  - KDOQI 準確率：**79.1%**，本研究方法提升至 **81.8%**
  - **AUC 從 0.62 提升至 0.73**

## 6. 結論
- 本研究提出 **樹狀機器學習模型 + 不確定性分析** 的方法，提升透析患者血管通路功能障礙的預測準確性。
- 相較於 KDOQI 指南，本方法 **提高準確度並減少錯誤預測**，能有效支援臨床決策。
- 未來可進一步結合 **深度學習** 或 **更多臨床數據**，以提升模型的適用性。

本研究的創新點在於「不確定性管理」與「樹模型結合」，為慢性血液透析患者的診斷提供更可靠的決策支持。
